<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title> ğŸ’The END GAMEğŸ’ </title>
        <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            background-image: url("images/èƒŒæ™¯.jpg");
            background-size: cover;
            background-repeat: no-repeat;
            background-position: center center;
            color: #fff;
            margin: 0;
        }
        h1 { margin: 20px 0; }
        button {
            margin: 10px;
            padding: 10px 20px;
            font-size: 1em;
            cursor: pointer;
        }
        .container { display: flex; justify-content: center; margin: 20px; }
        .monster {
            width: 200px; height: 200px; object-fit: contain;
            background-color: black; border: 2px solid #fff;
        }
        .status-bar {
            display: inline-block;
            width: 60%;
            background: #444;
            height: 20px;
            border-radius: 10px;
            overflow: hidden;
            vertical-align: middle; /* å‚ç›´å°é½Š */
        }

        .health {
            height: 100%;
            background-color: #4caf50;
            transition: width 0.2s;
        }
        button { margin: 10px; padding: 10px 20px; font-size: 1em; cursor: pointer; }
        #log { background-color: #333; padding: 10px; border-radius: 10px; max-height: 200px; overflow-y: auto; }
        #heroList { display: flex; justify-content: center; flex-wrap: wrap; margin: 10px auto; }
        .hero-card { margin: 10px; text-align: center; color: #f4f4f4; }
        .hero-card img { width: 150px; height: 150px; }
        #restartBtn { display: none; margin-top: 20px; padding: 10px 20px; font-size: 1.2em; background-color: #ff5733; color: #fff; border-radius: 5px; cursor: pointer; }
    </style>
</head>
<body>
    <h1>ğŸ’ The END GAME ğŸ’</h1>
        <audio id="bgm" autoplay loop>
        <source src="audio/Alan Silvestri - Portals (From  Avengers_ Endgame _Audio Only).mp3" type="audio/mp3">
        æ‚¨çš„ç€è¦½å™¨ä¸æ”¯æ´éŸ³æ¨‚æ’­æ”¾ã€‚
    </audio>

    <button onclick="playBGM()">æ’­æ”¾éŸ³æ¨‚</button>
    <button onclick="pauseBGM()">æš«åœéŸ³æ¨‚</button><br>

    <img src="images/åšå£«.png" alt="åšå£«" class="banner"><br>
    <h2>" Try to Find your 1/14,000,605 ğŸ’«"</h2>
    <div>ç©å®¶è¡€é‡ï¼š
        <div class="status-bar">
            <div id="playerHpBar" class="health"></div>
        </div>
        <span id="playerHpValue">200/200</span>
    </div>
    <div>æ€ªç¸è¡€é‡ï¼š
        <div class="status-bar">
            <div id="monsterHpBar" class="health"></div>
        </div>
        <span id="monsterHpValue">50/50</span>
    </div>
    <div>ç›®å‰æ€ªç¸: <span id="currentMonsterName">é»‘çŸ®æ˜Ÿ</span></div>
    <div id="heroList">å·²æ‹›å‹Ÿè‹±é›„: ç„¡</div>

    <div class="container">
        <img src="" id="monsterImage" class="monster" alt="æ€ªç¸">
    </div>

    <button id="recruitBtn" onclick="recruitHero()">æ‹›å‹Ÿè‹±é›„</button>
    <button id="attackBtn" onclick="attackMonster()">æ”»æ“Šæ€ªç¸</button>
    <div id="log"></div>
    <button id="restartBtn" onclick="restartGame()">å¥½å¥½ç© å†ç©ä¸€æ¬¡</button>

    <script>
        const bgm = document.getElementById("bgm");

        function playBGM() {
            bgm.play();
        }

        function pauseBGM() {
            bgm.pause();
        }

        let playerHp, monsterHp, currentLevel, playerMaxHp, monsterMaxHp, heroes;
        let spidermanDodge = 0; // èœ˜è››äººçš„é–ƒèº²æ¬¡æ•¸
        let round = 1; // æ–°å¢å›åˆæ•¸

        const monsters = [
            { name: "é»‘çŸ®æ˜Ÿ", image: "images/é»‘çŸ®æ˜Ÿ.jpg", maxHp: 50 },
            { name: "çƒæœ¨å–‰", image: "images/çƒæœ¨å–‰.jpg", maxHp: 100 },
            { name: "è¶…å·¨æ˜Ÿ", image: "images/è¶…å·¨æ˜Ÿ.jpg", maxHp: 150 },
            { name: "æš—å¤œæ¯”é„°æ˜Ÿ", image: "images/æš—å¤œæ¯”é„°æ˜Ÿ.jpg", maxHp: 200 },
            { name: "è–©è«¾æ–¯", image: "images/è–©è«¾æ–¯.jpg", maxHp: 300 }
        ];

        const heroPool = [
            { name: "å‚³å¥‡è‹±é›„ï¼šé©šå¥‡éšŠé•·", rarity: "å‚³å¥‡", attack: 50, image: "images/é©šå¥‡éšŠé•·.png", probability: 0.1, skill: "finalBoss" },
            { name: "å²è©©è‹±é›„ï¼šé‹¼éµäºº", rarity: "å²è©©", attack: 30, image: "images/é‹¼éµäºº.png", probability: 0.2, skill: "reduceDamage" },
            { name: "ç¨€æœ‰è‹±é›„ï¼šèœ˜è››äºº", rarity: "ç¨€æœ‰", attack: 20, image: "images/èœ˜è››äºº.png", probability: 0.3, skill: "dodge" },
            { name: "æ™®é€šè‹±é›„ï¼šé·¹çœ¼", rarity: "æ™®é€š", attack: 10, image: "images/é·¹çœ¼.png", probability: 0.4, skill: "heal" }
        ];

        function initializeGame() {
            playerHp = 200;
            playerMaxHp = 200;
            currentLevel = 0;
            heroes = [];
            spidermanDodge = 0;
            round = 1; // åˆå§‹åŒ–å›åˆæ•¸
            startLevel();
            document.getElementById("recruitBtn").disabled = false;
            document.getElementById("attackBtn").disabled = false;
            document.getElementById("restartBtn").style.display = "none";
            document.getElementById("log").innerHTML = "";
            document.getElementById("heroList").innerHTML = "";
            updateHealthBars();
        }

        function log(message) {
            const logDiv = document.getElementById("log");
            logDiv.innerHTML += `<p>ã€ç¬¬ ${round} å›åˆã€‘${message}</p>`;
            logDiv.scrollTop = logDiv.scrollHeight;
        }

        function startLevel() {
            const monster = monsters[currentLevel];
            monsterHp = monster.maxHp;
            monsterMaxHp = monster.maxHp;

            document.getElementById("monsterImage").src = monster.image;
            document.getElementById("currentMonsterName").innerText = monster.name;
            log(`âš”ï¸ æŒ‘æˆ° ${monster.name} é–‹å§‹ï¼`);
            updateHealthBars();
        }

        function updateHealthBars() {
            const playerHpPercentage = (playerHp / playerMaxHp) * 100;
            const monsterHpPercentage = (monsterHp / monsterMaxHp) * 100;

            // æ›´æ–°è¡€æ¢å¯¬åº¦
            document.getElementById("playerHpBar").style.width = playerHpPercentage + "%";
            document.getElementById("monsterHpBar").style.width = monsterHpPercentage + "%";

            // æ›´æ–°è¡€é‡æ•¸å€¼
            document.getElementById("playerHpValue").innerText = `${playerHp}/${playerMaxHp}`;
            document.getElementById("monsterHpValue").innerText = `${Math.max(monsterHp, 0)}/${monsterMaxHp}`;
        }

        function recruitHero() {
            let rand = Math.random();
            let cumulativeProbability = 0;

            for (const hero of heroPool) {
                if (heroes.some(h => h.name === hero.name)) continue;

                cumulativeProbability += hero.probability;
                if (rand <= cumulativeProbability) {
                    heroes.push(hero);
                    applyHeroSkill(hero);
                    log(`ğŸ‰ æ‹›å‹Ÿåˆ° ${hero.rarity} - ${hero.name}ï¼æ”»æ“ŠåŠ›ï¼š${hero.attack}`);
                    renderHeroList();
                    monsterAttack();
                    round++; // å›åˆæ•¸å¢åŠ 
                    return;
                }
            }

            log("âš ï¸ è‹±é›„æœªéŸ¿æ‡‰å¾µæ‹›ï¼Œè«‹å†è©¦ä¸€æ¬¡ï¼");
            monsterAttack();
            round++; // å›åˆæ•¸å¢åŠ 
        }

        function applyHeroSkill(hero) {
            if (hero.skill === "heal") log("ğŸ©¹ é·¹çœ¼æŠ€èƒ½è§¸ç™¼ï¼šæ¯æ¬¡æ”»æ“Šæ™‚å›å¾© 20 è¡€é‡ï¼");
            if (hero.skill === "dodge") {
                spidermanDodge = 2;
                log("ğŸ•·ï¸ èœ˜è››äººæŠ€èƒ½è§¸ç™¼ï¼šç²å¾— 2 æ¬¡é–ƒèº²å‚·å®³æ©Ÿæœƒï¼");
            }
            if (hero.skill === "reduceDamage") log("ğŸ›¡ï¸ é‹¼éµäººæŠ€èƒ½è§¸ç™¼ï¼šæ‰€æœ‰å‚·å®³æ¸›å°‘ 20%ï¼");
            if (hero.skill === "finalBoss") {
                log("ğŸš€ é©šå¥‡éšŠé•·æŠ€èƒ½è§¸ç™¼ï¼šç›´æ¥é€²å…¥æœ€çµ‚é—œå¡è–©è«¾æ–¯ï¼");
                currentLevel = monsters.length - 1;
                startLevel();
            }
        }

        function attackMonster() {
            const totalAttack = heroes.reduce((sum, hero) => sum + hero.attack, 0);

            if (totalAttack === 0) {
                log("âš ï¸ å°šæœªæ‹›å‹Ÿè‹±é›„ï¼Œç„¡æ³•æ”»æ“Šï¼");
                monsterAttack();
                return;
            }

            monsterHp -= totalAttack;
            updateHealthBars(); // ç«‹å³æ›´æ–°è¡€é‡æ¢
            log(`ğŸ—¡ï¸ è‹±é›„ç¸½æ”»æ“ŠåŠ› ${totalAttack}ï¼Œæ€ªç¸å‰©é¤˜è¡€é‡ï¼š${Math.max(monsterHp, 0)}/${monsterMaxHp}`);

            // é·¹çœ¼æŠ€èƒ½ï¼šå›è¡€ï¼Œé™åˆ¶è¡€é‡ä¸è¶…éæœ€å¤§å€¼
            if (heroes.some(hero => hero.skill === "heal")) {
                playerHp = Math.min(playerHp + 20, playerMaxHp);
                log("ğŸ©¹ é·¹çœ¼æŠ€èƒ½è§¸ç™¼ï¼šå›å¾© 20 è¡€é‡ï¼");
                updateHealthBars();
            }

            if (monsterHp <= 0) {
                log(`ğŸŠ æˆåŠŸæ“Šæ•— ${monsters[currentLevel].name}ï¼`);
                nextLevel();
            } else {
                monsterAttack();
            }
            round++; // å›åˆæ•¸å¢åŠ 
        }

        function monsterAttack() {
            if (spidermanDodge > 0) {
                spidermanDodge--;
                log(`ğŸ•·ï¸ èœ˜è››äººæŠ€èƒ½è§¸ç™¼ï¼šæˆåŠŸé–ƒèº²å‚·å®³ï¼å‰©é¤˜é–ƒèº²æ¬¡æ•¸ï¼š${spidermanDodge}`);
                return;
            }

            let damage = 40 + currentLevel * 5;

            if (heroes.some(hero => hero.skill === "reduceDamage")) {
                damage = Math.floor(damage * 0.8);
                log(`ğŸ›¡ï¸ é‹¼éµäººæŠ€èƒ½è§¸ç™¼ï¼šå‚·å®³æ¸›å°‘è‡³ ${damage}`);
            }

            playerHp -= damage;

            // ç¢ºä¿ç©å®¶è¡€é‡ä¸ä½æ–¼ 0
            if (playerHp < 0) playerHp = 0;

            updateHealthBars(); // æ›´æ–°è¡€æ¢
            log(`âš”ï¸ ${monsters[currentLevel].name} æ”»æ“Šï¼ç©å®¶å—åˆ° ${damage} å‚·å®³ï¼Œå‰©é¤˜è¡€é‡ï¼š${playerHp}/${playerMaxHp}`);

            if (playerHp <= 0) {
                updateHealthBars(); // ç¢ºä¿è¡€é‡æ¢ç‚ºé›¶
                log("ğŸ’€ ç©å®¶è¡€é‡æ­¸é›¶ï¼ŒéŠæˆ²çµæŸï¼");
                endGame();
            }
        }

        function nextLevel() {
            currentLevel++;
            if (currentLevel >= monsters.length) {
                log("ğŸ† æ­å–œé€šé—œï¼æ“Šæ•—æ‰€æœ‰æ€ªç¸ï¼");
                endGame();
                return;
            }
            startLevel();
        }

        function endGame() {
            document.getElementById("recruitBtn").disabled = true;
            document.getElementById("attackBtn").disabled = true;
            document.getElementById("restartBtn").style.display = "inline-block";
        }

        function restartGame() {
            initializeGame();
            log("ğŸ”„ éŠæˆ²é–‹å§‹ï¼");
        }

        function renderHeroList() {
            const heroList = document.getElementById("heroList");
            heroList.innerHTML = heroes.map(hero => `
                <div class="hero-card">
                    <img src="${hero.image}" alt="${hero.name}">
                    <p>${hero.name} (${hero.attack})</p>
                </div>
            `).join("");
        }

        initializeGame();
    </script>

</body>
</html>